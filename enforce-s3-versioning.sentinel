import "tfplan/v2" as tfplan

list_of_s3_bucket_without_versioning =  filter tfplan.resource_changes as _, rc {
		rc.type is "aws_s3_bucket" and
			rc.mode is "managed" and
    	rc.change.actions is ["create"] 
		rc.change.after_unknown.versioning.enabled is true
}

print(list_of_s3_bucket_without_versioning)

enforce_s3_versioning = rule  {
 length(list_of_s3_bucket_without_versioning)==0
}

main = rule {
	enforce_s3_versioning
}