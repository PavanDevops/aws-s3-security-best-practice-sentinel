import "tfplan/v2" as tfplan

enforce_s3_mfa_delete = rule {
	all filter tfplan.resource_changes as _, rc {
		rc.type is "aws_s3_bucket" and
			rc.mode is "managed" and
    	rc.change.actions is ["no-op"]
	} as _, frc {
		length(filter frc.change.after.versioning as config {
    	config.enabled is not false and
        config.mfa_delete is not false
    }) > 0
	}
}
main = rule {
	enforce_s3_mfa)_delete
}